import React, { useEffect, useState } from 'react';
import styles from '../styles';

// comp
import Card from './Card-col';

// redux
import { useSelector } from "react-redux";

const Cart = () => {
    const state = useSelector((state) => state);
    const [, updateState] = useState();
    const processedIds = new Set();

    useEffect(() => {
        updateState({}); // Triggers a re-render
    }, [state.items]);

    const totalPrice = state.items.reduce((acc, item) => acc + item.price, 0);

    return (
            <div id='cart_log' className={` hidden bg-primary-black rounded-xl absolute top-0 right-0 min-w-[400px] mt-[70px] z-10 text-secondary-white p-4 max-w-[400px] Cart`}>
                {state.items.length !== 0 ? 
                
                <div className={`${styles.flexStart} flex-col w-full h-[400px] overflow-y-auto gap-4 pb-4`}>
                    {state.items.map(hoodie => {
                        if (processedIds.has(hoodie.id)) return null;
                        processedIds.add(hoodie.id);
                        return <Card key={hoodie.id} hoodie={hoodie} />;
                    })}
                </div>

                :

                <div className={`${styles.flexCenter} flex-col w-full h-[400px] overflow-y-auto gap-4 pb-4`}>
                    <svg width="200" height="200" viewBox="0 0 319 369" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M312.369 0H5.6499C4.15145 0 2.71437 0.595167 1.65481 1.65473C0.595245 2.71429 0 4.1514 0 5.64985V29.3321C0 30.8306 0.595245 32.2677 1.65481 33.3272C2.71437 34.3868 4.15145 34.9821 5.6499 34.9821H16.5776L54.706 171.392H263.279L303.336 34.9821H312.369C313.867 34.9821 315.305 34.3868 316.364 33.3272C317.424 32.2677 318.019 30.8306 318.019 29.3321V5.64985C318.019 4.1514 317.424 2.71429 316.364 1.65473C315.305 0.595167 313.867 0 312.369 0V0ZM82.3127 155.254H71.6896L58.9688 104.709H82.2113L82.3127 155.254ZM82.3127 87.5905H54.7398L43.5077 43.4061H82.2113L82.3127 87.5905ZM119.798 157.013H102.104V104.709H119.798V157.013ZM119.798 87.5905H102.104V43.4061H119.798V87.5905ZM156.134 157.013H138.474V104.709H156.134V157.013ZM156.134 87.5905H138.474V43.4061H156.134V87.5905ZM192.503 157.013H174.809V104.709H192.503V157.013ZM192.503 87.5905H174.809V43.4061H192.503V87.5905ZM228.838 157.013H211.077V104.709H228.737L228.838 157.013ZM228.838 87.5905H211.077V43.4061H228.737L228.838 87.5905ZM254.55 155.254H244.029V104.709H267.271L254.55 155.254ZM271.466 87.5905H243.893V43.4061H282.597L271.466 87.5905Z" fill="#6F00FF"/>
                        <path d="M314.094 34.9145C314.094 35.3881 244.638 35.7941 159.009 35.7941C73.381 35.7941 3.92438 35.3881 3.92438 34.9145C3.92438 34.4408 73.3472 34.0349 159.009 34.0349C244.671 34.0349 314.094 34.4408 314.094 34.9145Z" fill="#263238"/>
                        <g opacity="0.4">
                        <path d="M312.369 0H5.6499C4.15145 0 2.71437 0.595167 1.65481 1.65473C0.595245 2.71429 0 4.1514 0 5.64985V29.3321C0 30.8306 0.595245 32.2677 1.65481 33.3272C2.71437 34.3868 4.15145 34.9821 5.6499 34.9821H16.5776L54.706 171.392H263.279L303.336 34.9821H312.369C313.867 34.9821 315.305 34.3868 316.364 33.3272C317.424 32.2677 318.019 30.8306 318.019 29.3321V5.64985C318.019 4.1514 317.424 2.71429 316.364 1.65473C315.305 0.595167 313.867 0 312.369 0V0ZM82.3127 155.254H71.6896L58.9688 104.709H82.2113L82.3127 155.254ZM82.3127 87.5905H54.7398L43.5077 43.4061H82.2113L82.3127 87.5905ZM119.798 157.013H102.104V104.709H119.798V157.013ZM119.798 87.5905H102.104V43.4061H119.798V87.5905ZM156.134 157.013H138.474V104.709H156.134V157.013ZM156.134 87.5905H138.474V43.4061H156.134V87.5905ZM192.503 157.013H174.809V104.709H192.503V157.013ZM192.503 87.5905H174.809V43.4061H192.503V87.5905ZM228.838 157.013H211.077V104.709H228.737L228.838 157.013ZM228.838 87.5905H211.077V43.4061H228.737L228.838 87.5905ZM254.55 155.254H244.029V104.709H267.271L254.55 155.254ZM271.466 87.5905H243.893V43.4061H282.597L271.466 87.5905Z" fill="black"/>
                        </g>
                        <path d="M233.033 82.042H32.3093L20.1975 92.3606L60.4235 236.247H265.241L305.501 99.0931L233.033 82.042ZM87.5566 220.549H77.4071L49.6988 110.596H87.7258L87.5566 220.549ZM124.332 222.207H106.875V110.562H124.23L124.332 222.207ZM160.058 222.207H142.669V110.562H160.058V222.207ZM195.751 222.207H178.395V110.562H195.751V222.207ZM231.443 222.207H214.087V110.562H231.443V222.207ZM256.682 220.549H246.329V110.596H284.356L256.682 220.549Z" fill="#6F00FF"/>
                        <path d="M280.263 154.002H45.4361V170.918H280.263V154.002Z" fill="#6F00FF"/>
                        <path d="M312.64 68.103H13.0929C9.58011 68.103 6.73248 70.9507 6.73248 74.4634V96.0481C6.73248 99.5609 9.58011 102.409 13.0929 102.409H312.64C316.152 102.409 319 99.5609 319 96.0481V74.4634C319 70.9507 316.152 68.103 312.64 68.103Z" fill="#6F00FF"/>
                        <path d="M315.143 102.375C315.143 102.882 246.972 103.255 162.9 103.255C78.8282 103.255 10.6571 102.882 10.6571 102.375C10.6571 101.867 78.8282 101.495 162.9 101.495C246.972 101.495 315.143 101.901 315.143 102.375Z" fill="#263238"/>
                        <path d="M312.369 132.283H5.6499C4.15145 132.283 2.71437 132.878 1.65481 133.938C0.595245 134.997 0 136.434 0 137.933V161.615C0 162.357 0.146139 163.092 0.430073 163.777C0.714008 164.462 1.13017 165.085 1.65481 165.61C2.17945 166.135 2.80229 166.551 3.48777 166.835C4.17325 167.119 4.90795 167.265 5.6499 167.265H16.5776L54.706 303.675H263.279L303.336 167.265H312.369C313.111 167.265 313.846 167.119 314.531 166.835C315.217 166.551 315.839 166.135 316.364 165.61C316.889 165.085 317.305 164.462 317.589 163.777C317.873 163.092 318.019 162.357 318.019 161.615V137.933C318.019 136.434 317.424 134.997 316.364 133.938C315.305 132.878 313.867 132.283 312.369 132.283V132.283ZM82.3127 287.537H71.6896L58.9688 237.026H82.2113L82.3127 287.537ZM82.3127 219.873H54.7398L43.6092 175.655H82.3127V219.873ZM119.798 289.33H102.104V237.026H119.798V289.33ZM119.798 219.873H102.104V175.554H119.798V219.873ZM156.134 289.33H138.474V237.026H156.134V289.33ZM156.134 219.873H138.474V175.554H156.134V219.873ZM192.503 289.33H174.809V237.026H192.503V289.33ZM192.503 219.873H174.809V175.554H192.503V219.873ZM228.838 289.33H211.077V237.026H228.737L228.838 289.33ZM228.838 219.873H211.077V175.554H228.737L228.838 219.873ZM254.55 287.537H244.029V237.026H267.271L254.55 287.537ZM271.466 219.873H243.893V175.554H282.597L271.466 219.873Z" fill="#6F00FF"/>
                        <path d="M314.094 167.197C314.094 167.704 244.638 168.076 159.009 168.076C73.381 168.076 3.92438 167.704 3.92438 167.197C3.92438 166.689 73.3472 166.317 159.009 166.317C244.671 166.317 314.094 166.723 314.094 167.197Z" fill="#263238"/>
                        <g opacity="0.4">
                        <path d="M312.369 132.283H5.6499C4.15145 132.283 2.71437 132.878 1.65481 133.938C0.595245 134.997 0 136.434 0 137.933V161.615C0 162.357 0.146139 163.092 0.430073 163.777C0.714008 164.462 1.13017 165.085 1.65481 165.61C2.17945 166.135 2.80229 166.551 3.48777 166.835C4.17325 167.119 4.90795 167.265 5.6499 167.265H16.5776L54.706 303.675H263.279L303.336 167.265H312.369C313.111 167.265 313.846 167.119 314.531 166.835C315.217 166.551 315.839 166.135 316.364 165.61C316.889 165.085 317.305 164.462 317.589 163.777C317.873 163.092 318.019 162.357 318.019 161.615V137.933C318.019 136.434 317.424 134.997 316.364 133.938C315.305 132.878 313.867 132.283 312.369 132.283V132.283ZM82.3127 287.537H71.6896L58.9688 237.026H82.2113L82.3127 287.537ZM82.3127 219.873H54.7398L43.6092 175.655H82.3127V219.873ZM119.798 289.33H102.104V237.026H119.798V289.33ZM119.798 219.873H102.104V175.554H119.798V219.873ZM156.134 289.33H138.474V237.026H156.134V289.33ZM156.134 219.873H138.474V175.554H156.134V219.873ZM192.503 289.33H174.809V237.026H192.503V289.33ZM192.503 219.873H174.809V175.554H192.503V219.873ZM228.838 289.33H211.077V237.026H228.737L228.838 289.33ZM228.838 219.873H211.077V175.554H228.737L228.838 219.873ZM254.55 287.537H244.029V237.026H267.271L254.55 287.537ZM271.466 219.873H243.893V175.554H282.597L271.466 219.873Z" fill="black"/>
                        </g>
                        <path d="M229.177 214.764H28.4526L16.3408 224.914L56.6007 368.902H261.418L301.678 231.782L229.177 214.764ZM83.6999 353.272H73.5504L45.6392 243.318H83.6661L83.6999 353.272ZM120.509 354.895H103.153V243.251H120.543L120.509 354.895ZM156.201 354.895H138.846V243.251H156.201V354.895ZM191.894 354.895H174.538V243.251H191.894V354.895ZM227.587 354.895H210.231V243.251H227.587V354.895ZM252.825 353.272H242.506V243.318H280.432L252.825 353.272Z" fill="#6F00FF"/>
                        <path d="M276.406 286.724H41.5792V303.64H276.406V286.724Z" fill="#6F00FF"/>
                        <path d="M308.783 200.792H9.23598C5.72324 200.792 2.87561 203.64 2.87561 207.152V228.737C2.87561 232.25 5.72324 235.097 9.23598 235.097H308.783C312.295 235.097 315.143 232.25 315.143 228.737V207.152C315.143 203.64 312.295 200.792 308.783 200.792Z" fill="#6F00FF"/>
                        <path d="M311.286 235.097C311.286 235.571 243.115 235.977 159.043 235.977C74.9713 235.977 6.80023 235.571 6.80023 235.097C6.80023 234.624 74.9713 234.218 159.043 234.218C243.115 234.218 311.286 234.624 311.286 235.097Z" fill="#263238"/>
                    </svg>
                    <p className='font-bold'>No Items in the cart yet (⋟﹏⋞). </p>
                </div>

                }   

                <hr className=' opacity-10 pb-2' />
                <div className={` ${styles.flexBetween} py-1`}>
                    <p>Total</p>
                    <p className='font-bold'>{totalPrice} MAD</p>
                </div>
                <div className={` ${styles.flexBetween} py-1`}>
                    <p>Shipping</p>
                    <p className='font-bold'>Free</p>
                </div>
                <button className='Button-P rounded-lg mt-2 text-sm w-full'>
                    <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.5 10.5L11.1 9.1L12.675 7.5H8.5V5.5H12.675L11.075 3.9L12.5 2.5L16.5 6.5L12.5 10.5ZM7.5 22.5C6.95 22.5 6.47933 22.3043 6.088 21.913C5.696 21.521 5.5 21.05 5.5 20.5C5.5 19.95 5.696 19.479 6.088 19.087C6.47933 18.6957 6.95 18.5 7.5 18.5C8.05 18.5 8.52067 18.6957 8.912 19.087C9.304 19.479 9.5 19.95 9.5 20.5C9.5 21.05 9.304 21.521 8.912 21.913C8.52067 22.3043 8.05 22.5 7.5 22.5ZM17.5 22.5C16.95 22.5 16.4793 22.3043 16.088 21.913C15.696 21.521 15.5 21.05 15.5 20.5C15.5 19.95 15.696 19.479 16.088 19.087C16.4793 18.6957 16.95 18.5 17.5 18.5C18.05 18.5 18.521 18.6957 18.913 19.087C19.3043 19.479 19.5 19.95 19.5 20.5C19.5 21.05 19.3043 21.521 18.913 21.913C18.521 22.3043 18.05 22.5 17.5 22.5ZM1.5 4.5V2.5H4.775L9.025 11.5H16.025L19.925 4.5H22.2L17.8 12.45C17.6167 12.7833 17.3707 13.0417 17.062 13.225C16.754 13.4083 16.4167 13.5 16.05 13.5H8.6L7.5 15.5H19.5V17.5H7.5C6.75 17.5 6.179 17.175 5.787 16.525C5.39567 15.875 5.38333 15.2167 5.75 14.55L7.1 12.1L3.5 4.5H1.5Z" fill="white"/>
                    </svg>

                    La caisse
                </button> 
            </div>
    );
};

export default Cart;